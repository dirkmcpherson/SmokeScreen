{"version":3,"file":"background.js","sources":["dist/menu/dev_menu_template.js","dist/menu/edit_menu_template.js","dist/browser.js","dist/env.js","dist/background.js"],"sourcesContent":["import { app, BrowserWindow } from 'electron';\nexport var devMenuTemplate = {\n    label: 'Development',\n    submenu: [{\n            label: 'Reload',\n            accelerator: 'CmdOrCtrl+R',\n            click: function () {\n                BrowserWindow.getFocusedWindow().webContents.reloadIgnoringCache();\n            }\n        }, {\n            label: 'Toggle DevTools',\n            accelerator: 'Alt+CmdOrCtrl+I',\n            click: function () {\n                BrowserWindow.getFocusedWindow().toggleDevTools();\n            }\n        }, {\n            label: 'Quit',\n            accelerator: 'CmdOrCtrl+Q',\n            click: function () {\n                app.quit();\n            }\n        }]\n};\n","export var editMenuTemplate = {\n    label: 'Edit',\n    submenu: [\n        { label: \"Undo\", accelerator: \"CmdOrCtrl+Z\", selector: \"undo:\" },\n        { label: \"Redo\", accelerator: \"Shift+CmdOrCtrl+Z\", selector: \"redo:\" },\n        { type: \"separator\" },\n        { label: \"Cut\", accelerator: \"CmdOrCtrl+X\", selector: \"cut:\" },\n        { label: \"Copy\", accelerator: \"CmdOrCtrl+C\", selector: \"copy:\" },\n        { label: \"Paste\", accelerator: \"CmdOrCtrl+V\", selector: \"paste:\" },\n        { label: \"Select All\", accelerator: \"CmdOrCtrl+A\", selector: \"selectAll:\" }\n    ]\n};\n","var rp = require('request-promise');\nvar cheerio = require('cheerio');\nvar fs = require('fs');\n// var log = function (msg: string, path: string) {\n//     console.log(msg)\n//     path = path + '/smoke_screen_log.txt'\n// }\nvar ROOT_PREFIX = 'https://www.';\nvar ROOT_CHANGE_INTERVAL = 10; // How often we change which root url we're using\nvar Browser = /** @class */ (function () {\n    function Browser() {\n        var _this = this;\n        this.rootURLs = ['infowars.com', 'slate.com', 'reddit.com'];\n        this.rootURLIdx = 0;\n        this.urlIncrementCount = 0;\n        this.options = {\n            uri: this.nextURL,\n            transform: function (body) {\n                return cheerio.load(body);\n            }\n        };\n        this.selectNextURL = function (toVisit) {\n            return new Promise(function (resolve) {\n                if (toVisit) {\n                    _this.nextURL = toVisit;\n                }\n                else {\n                    _this.urlIncrementCount += 1;\n                    if ((_this.urlIncrementCount % ROOT_CHANGE_INTERVAL) == 0) {\n                        _this.rootURLIdx = (_this.rootURLIdx + 1) % _this.rootURLs.length;\n                        _this.path = ROOT_PREFIX + _this.rootURLs[_this.rootURLIdx];\n                        console.log(\"Incrementing root url to \" + _this.path);\n                        _this.nextURL = _this.path;\n                    }\n                    toVisit = _this.nextURL;\n                }\n                console.log('visiting ' + _this.nextURL);\n                _this.options.uri = _this.nextURL;\n                rp(_this.options)\n                    .then(function ($) {\n                    var urlToVisit = _this.path; // default to base URL\n                    var links = $('a');\n                    if (links.length == 0) {\n                        // no links, just visit the same root url\n                        console.log(\"No links found on page.\");\n                    }\n                    else {\n                        var randomIdx = Math.floor(Math.random() * $(links).length);\n                        // We only want to navigate to URLs within the original root domain\n                        var href = $(links)[randomIdx].attribs.href;\n                        // console.log('Randomly selected ' + href);\n                        if (href.includes(_this.rootURLs[_this.rootURLIdx])) {\n                            urlToVisit = href;\n                        }\n                        else if (!href.includes('http')) {\n                            urlToVisit = _this.path + href;\n                        }\n                    }\n                    _this.nextURL = urlToVisit;\n                    // console.log('returning with val ' + this.nextURL)\n                    resolve(_this.nextURL);\n                })\n                    .catch(function (err) {\n                    console.log('Error accessing page, reverting to root path.');\n                    _this.nextURL = _this.path;\n                    resolve(_this.path);\n                });\n            });\n        };\n        this.path = ROOT_PREFIX + this.rootURLs[this.rootURLIdx];\n        this.nextURL = this.path;\n    }\n    return Browser;\n}());\nexport { Browser };\n","// Simple wrapper exposing environment variables to rest of the code.\nvar jetpack = require('fs-jetpack');\n// The variables have been written to `env.json` by the build process.\nvar env = jetpack.cwd(__dirname).read('env.json', 'json');\nexport default env;\n","// This is main process of Electron, started as first thing when your\n// app starts. This script is running through entire life of your application.\n// It doesn't have any windows which you can see on screen, but we can open\n// window from here.\nimport * as path from 'path';\nimport * as url from 'url';\nimport { app, Menu, BrowserWindow } from 'electron';\nimport { devMenuTemplate } from './menu/dev_menu_template';\nimport { editMenuTemplate } from './menu/edit_menu_template';\nimport { Browser } from './browser';\n// Special module holding environment variables which you declared\n// in config/env_xxx.json file.\nimport env from './env';\nvar mainWindow;\nvar browserWindow;\nvar transparentWindowOverlay;\nvar setApplicationMenu = function () {\n    var menus = [editMenuTemplate];\n    if (env.name !== 'production') {\n        menus.push(devMenuTemplate);\n    }\n    Menu.setApplicationMenu(Menu.buildFromTemplate(menus));\n};\n// Save userData in separate folders for each environment.\n// Thanks to this you can use production and development versions of the app\n// on same machine like those are two separate apps.\nif (env.name !== 'production') {\n    var userDataPath = app.getPath('userData');\n    app.setPath('userData', userDataPath + ' (' + env.name + ')');\n}\nvar browser = new Browser();\nvar browserUpdateIntervalID = null;\nvar updatePage = function () {\n    var currentURL = browser.nextURL;\n    browser.selectNextURL()\n        .then(function (nextURL) {\n        browserWindow.loadURL(nextURL);\n    });\n};\nvar update;\napp.on('ready', function () {\n    setApplicationMenu();\n    browserUpdateIntervalID = setInterval(updatePage, 5000);\n    var x_start = 0;\n    var y_start = 0;\n    var w = 250;\n    var h = 225;\n    browserWindow = new BrowserWindow({\n        x: x_start,\n        y: y_start,\n        width: w,\n        height: h,\n        show: false,\n        icon: path.join(__dirname, 'build/icons/512x512.png')\n    });\n    transparentWindowOverlay = new BrowserWindow({\n        parent: browserWindow,\n        x: x_start,\n        y: y_start,\n        transparent: true,\n        frame: false,\n        width: w,\n        height: h,\n        show: false\n    });\n    transparentWindowOverlay.setIgnoreMouseEvents(true);\n    transparentWindowOverlay.loadURL(url.format({\n        pathname: path.join(__dirname, 'app.html'),\n        protocol: 'file:',\n        slashes: true\n    }));\n    transparentWindowOverlay.setBrowser;\n    browserWindow.loadURL(browser.nextURL);\n    browserWindow.once('ready-to-show', function () {\n        browserWindow.show();\n        transparentWindowOverlay.show();\n    });\n    browserWindow.on('resize', function (e, x, y) {\n        // update child container size\n        var browserSize = browserWindow.getContentSize();\n        transparentWindowOverlay.setContentSize(browserSize[0], browserSize[1], true);\n    });\n    // if (env.name === 'development') {\n    //     mainWindow.openDevTools();\n    // }\n});\napp.on('window-all-closed', function () {\n    app.quit();\n});\n"],"names":["BrowserWindow","app","Menu","path.join","url.format"],"mappings":"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"}